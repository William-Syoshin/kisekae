# 🔧 画像分析修正：Vision機能の設定

## 現在の問題

AIの出力：
```
申し訳ありませんが、私はテキストベースのAIであり、画像を見る能力はありません。
```

**原因:** LLMブロックで画像が正しく渡されていないか、Vision機能が有効化されていません。

---

## 🎯 解決手順

### ステップ1: Difyワークフローを開く

```
https://dify.ai/
→ 画像分析ワークフローを開く
```

---

### ステップ2: LLMブロックを確認

#### 1. LLMブロックをクリック

#### 2. モデル設定を確認

**必須設定:**

```
プロバイダー: OpenAI
モデル: gpt-4o-mini（Vision対応モデル）
```

**重要:** 以下のモデルはVisionに対応していません：
- ❌ gpt-3.5-turbo
- ❌ gpt-4（古いバージョン）
- ✅ gpt-4o
- ✅ gpt-4o-mini （推奨）
- ✅ gpt-4-turbo
- ✅ gpt-4-vision-preview

#### 3. Vision機能を確認

**モデル設定の下に「Vision」のトグルがあるはずです:**

```
Vision: [トグルスイッチ] ← これをONにする
```

---

### ステップ3: 画像入力を正しく設定

#### 1. User Promptセクションを確認

**現在のプロンプト:**

```
この画像を分析して、詳しく説明してください。
```

#### 2. 画像を追加

**重要:** プロンプトの下に**画像入力欄**が必要です。

##### 方法A: 画像アイコンから追加

1. プロンプト入力欄の下または横に**画像アイコン** 📷 がある
2. クリックして「変数から選択」
3. `{{#start.image_file#}}` を選択

##### 方法B: ビジュアルエディタから追加

1. User Prompt欄の下に「**画像を追加**」または「**Add Image**」ボタンがある
2. クリック
3. 「変数から選択」
4. `{{#start.image_file#}}` を選択

#### 3. 確認

画像が追加されると、以下のように表示されるはずです：

```
User Prompt:
┌─────────────────────────────────────┐
│ この画像を分析して、詳しく説明して  │
│ ください。                          │
└─────────────────────────────────────┘

画像:
┌─────────────────────────────────────┐
│ 📷 {{#start.image_file#}}           │
└─────────────────────────────────────┘
```

---

### ステップ4: プロンプトを修正（オプション）

Vision対応のプロンプトに変更することをお勧めします：

**System Prompt:**

```
あなたは画像を詳しく分析する専門家です。
与えられた画像を見て、以下の観点から詳細に説明してください：

1. 全体的な印象
2. 人物の服装・ファッション
3. 色使いとスタイル
4. 雰囲気や特徴

必ず画像の内容を具体的に説明してください。
説明は日本語で、200〜300文字程度で自然な文章として出力してください。
```

**User Prompt:**

```
上記の画像を分析して、詳しく説明してください。
画像に写っている内容を具体的に述べてください。
```

---

### ステップ5: 保存・再公開

1. 「**保存**」をクリック
2. 「**公開**」をクリック

---

### ステップ6: サーバーを再起動（不要だが推奨）

```bash
npm run dev
```

---

## ✅ 確認ポイント

### Difyワークフローで確認

- [ ] モデルが`gpt-4o-mini`または他のVision対応モデル
- [ ] Visionトグルが**ON**（有効化）
- [ ] LLMブロックのUser Prompt下に画像入力がある
- [ ] 画像入力に`{{#start.image_file#}}`が設定されている
- [ ] 保存・再公開した

---

## 🎯 期待される出力

修正後、以下のような説明が得られるはずです：

```
💬
この画像には、明るい色のワンピースを着た女性が写っています。
服装は優雅でエレガントな印象を与え、赤やピンクのような
暖色系の色使いが特徴的です。全体的に華やかで女性らしい
雰囲気が演出されており、ファッション性の高いスタイルと
なっています。背景は... (続く)
```

---

## 🐛 トラブルシューティング

### 「Visionトグルが見つかりません」

**原因:** モデルがVisionに対応していない

**解決:**
1. モデルを`gpt-4o-mini`に変更
2. プロバイダーがOpenAIであることを確認

### 「画像を追加ボタンが見つかりません」

**原因:** LLMブロックのバージョンが古い可能性

**解決:**
1. LLMブロックを削除
2. 新しいLLMブロックを追加
3. 設定をやり直す

### 「まだテキストベースのAIと言われる」

**原因1:** Vision機能が無効

**解決:** Visionトグルを確認

**原因2:** 画像入力が設定されていない

**解決:** 画像入力を追加

**原因3:** 保存・再公開していない

**解決:** 必ず保存して再公開

---

## 📸 設定画面のイメージ

### 正しい設定

```
┌─────────────────────────────────────┐
│ LLMブロック設定                      │
├─────────────────────────────────────┤
│ プロバイダー: OpenAI               │
│ モデル: gpt-4o-mini                 │
│ Temperature: 0.7                    │
│ Max Tokens: 500                     │
│ Vision: [●─────] ON ← 重要！       │
├─────────────────────────────────────┤
│ System Prompt:                      │
│ あなたは画像を詳しく分析する...    │
├─────────────────────────────────────┤
│ User Prompt:                        │
│ この画像を分析して...               │
│                                     │
│ 📷 画像: {{#start.image_file#}}    │
│    ↑ これが重要！                  │
└─────────────────────────────────────┘
```

---

## 🎉 これで動くはずです！

修正後、再度写真を撮影してテストしてください！

結果を教えてください！✨


